
#include "kmath.h"

int krand_seed = 40392;

static int krand_table[RAND_TABLE_SIZE]=
	{
	-5547,   4807,  12556,  23647,  23280,  29784,  28470,  23625,
	7009,  20856,  17666,   1136,   2544,   4756,    861,  24182,
	6513,  12516,   1780, -27916,  20304,  11880,  17496,  32606,
	-25116,   3744,  19398, -23800, -29620, -17428,  23749,   1800,
	340,  15535,   1794,  22625,  11264,   5880,  11799,  12852,
	5290,  29516,   1148,   4482,  29484, -32040,    150,   7638,
	-23206,  15921,  16280,   5334, -23101,  14700,  20988,   7216,
	26543,   9990, -27694, -28884,  25610,  13968,    165,   1750,
	4900,   9688,   2688,   8277,  31464,   1863,  23975,   7198,
	3042, -26727,   3180,    165,  -3560,   7104,    770,  10332,
	23765,   9512,   3726,  11070,  25021,   8056,  23528, -30196,
	1886,   5954,  23861,   1680,  32448,  28557,  28413, -27592,
	1197,  12220,  18612,   2340,   5145,  10368,    957,  14982,
	6058, -29894,  31464,  19809, -28486,  32308,  12936,  31860,
	-23829,   7500,  24344,   5500, -23956,  27948,  23370,  31746,
	10112,   1980, -27904, -18208,  24800,    748,   3535,   8496,
	9831,  13098,  30988,  13230,  29394, -28486,  25908,  19110,
	16764,   3404,  25785,  12495,  12784,   6500,   1990,   4305,
	12546,   3430,   8004,  23876,   6308,  29808, -12757, -10347,
	3348,   6944,  10608, -23263, -19480,  -1786,   3760,   2500,
	484,   7696,   2958,   7752,  17612,    960,   8509,  24495,
	936,  30024,  12328,  16371,   9372,   2160,  11118,   2816,
	1816, -20578,   7065,   6864,  17280,  14145,    588,   1248,
	29232,  -8611,  16740,  12258,  24442,  17664, -16201,   7735,
	13938,    150,    255,    896,  23375,   2870,  17214,   1850,
	10950,  24640,  19188,   2565,  25632,   4746, -16894,  24072,
	17850,   7056,  29412,   2340,   7003,    561,  28800,  20564,
	-31796,   5610, -27133,   3175,  30000, -32572,  29747,   6570,
	6604,   1908,   3843,   3434,  14145,  17688,   7557,  17061,
	19050,  10752, -18970,   5148,   5202,  17125,   6422,  19879,
	};/*
	14883,   6650,  14094,   3116,  15041,  11505,  16037,  17654,
	26128,  19964,  15844,  15555,   5341,  29376,  -9856,  18105,
        76,   6960,   2805,  18204,    576,   1116,  15407,    108,
	-22950,   7904,    935, -30196,  29618,   4180, -10818,   3335,
	4960,  13524, -25766,  10506, -24366,  18549,  20210,   2520,
	374,  14872,    376,   6060,     69,  22139,   8400,   7952,
	6210,  11842, -13239, -16260,  22663,  31875,  20832,   1118,
	7644,  23493,   2760,   2736,  12948,  17646,   2880,   4448
	,7018,   4698,  29700,  11220,   1376,  31968,   1612,  31229,
     28112, -30178,  12402,   2808,  13860,  15732, -18236,  10920,
    -27266,  25597,   5850,   1888, -20578,   6280,  12087,   6745,
    -18304,  11342,   6560,   2180,   2544,  28336,   3625,  31659,
       455,  12482,   9552, -27886,    444,   7191,   5916,  22816,
     32340,   1050,  19838,  17679,   2046,   1007,  28125,  31800,
      2788,    364,   1230,   2604,   8106,    154, -22714,  21450,
      5478,  23532,  24192,    218, -18881,    424, -32048,  14560,
      3280,  13200,  23072,     44,   4608,  13529,   5796, -19696,
     29058,  11211,  11775, -26166,  26100, -29670,    126,  24585,
      4131,  25993,   1152,   1050,  13310,   4767,  17533,   9568,
     17301,   5538,  17767,  22379,  26670,   2356,    460,  15088,
     14945,   1700,  20720,    870,  20413,   9504, -10805,  15554,
     15300,   8428,   5434,  27577,  24073,  10200,    920,  26499,
      6006,   6375,    420,   3796,   1800,   6916,   1536,  11102,
      4386,  17220,   3010,   6142,  24309,   3318,  15000,  -9013,
    -29900,   9911,  10992,   4785,  13081,  15000,  17544,   6992,
      8260,   4158,    344,   2184,   2121,  23040,  24073, -16120,
     16928,   6444,  30277, -28012, -31754, -18936,  -2286,   6660,
     15876, -31236,  29040, -12344,  26896,  14696,  10080,   1653,
     17982,  13563,   8470,  -8416, -31723,  29388,   5412,   3588,
      4599,   5418,  24180,    765,   2418,   9430,  20128,   7383,
      8892, -26719,   2820,  15288,   4522,   4687, -10888,   7875,
      9912,  22785,   5434,   6715,  11165,   2430, -19908,   1216,
      1185,  28182,   8181, -31312,    268, -19906,   4940,   8330,
     -6256,  28080,    217, -20593,  15168,  12240,  18972,  17974,
     28798, -16030,  13752,  29808,  10373, -10455,    330,   7626,
     31540,    126,  21336, -32519,  12138,  20056,  25308,  18816,
     10224,   2880,  15438,   6350,  31620,   5425,   4248,  20732,
     18655,  28260,  11472,  17181,  25272, -23632,   3108,  31720,
    -13810,   2640,   7134, -27328,   4089,  10767,   5203,    370,
       756,    630,  17296,   8008,  32279,   4930,     75,  12840,
     32000, -16928,  10370,  26680,  26180,    816,   3381,  23320,
     12245,   1248,   3840, -31723,   2436,   3600,  30226,   8410,
     15300, -25009,  13392,  10208, -22672,   8424,    232,  24975,
    -31136,    880,  21939,   5400,   7623,   5040,   2911, -31726,
      1338,   3154,  15552,  17266,  24830,   7695,   1236,   9768,
      1170,   2050,   3519,    428,   3528,  10816,  31970,  15621,
      5278,  17654,    170,   1152,   9163,  11797,   8100,   3219,
     27250,   6960,  11520,  17576,   9324,  13776,  12189,  29177,
      5916,  16646,  22704, -27916,  10804, -28114,   2412,   5670,
     12480,  14763,    388,   8056,   1274, -31417, -12536,   1365,
    -24896,  32536,  29640,  13208,   1840,  19975,  26741,   3267,
     17731,   4660,   6480,  30613,    535,  14280,  26775,   4064,
     25200,  10656,   4750,  29095,  17376,  11760,     58,  19812,
     11232, -30109,  15138,   7259,  11160,   1200,    585,    176,
    -21184,  32617,  10842, -18511,  -6264,   5020, -16536,  23896,
      5396,   8928,  12261,   6715,  13545,   3502,    880,   2295,
     23530,   3111,  12258,  32536,  27216,  23184,   5490,   1530,
      2413,    935,   2379,   6216,   1845,  13320,  28755,   8798,
      3906, -28137,    924,  18300,    888,   4796, -20914,   6536,
     24257,   5310,  17136,     39,   8316,   3404,  21924,   6660,
      2196,  15369,  17457,  11615,   2413,   4011,  22576,    920,
      5625,  10692,  20447,  16147,  16445, -24226,  11475,  32175,
      3675,   2277,   6072, -25864,  11625,  15106, -30760,   1170,
     26568,  19140,   7052,  10780,  10788,  23450,   6300,    800,
      2052, -12496,  12192,    222,   3604,   7596,  10710,   4335,
      3880,  11592,  32046,  25956,    288, -29244, -31132,  10573,
     21390,   8591,    578,    483,  11737,  14896,  17892,   5292,
    -31712, -18550,  13680, -28924,  17982,  20234,   5502,  25956,
     13091,   2175, -23602, -31264,  24030,  10416,   7752,  25872,
      2030, -27379,   9576,  11476, -30864,  25289,   9072,    490,
       588,    133,   1890,  21896,   8134, -30936, -32650,   6834,
     20150,  15222,   5612,   1225,   1634,   7740, -29824, -12751,
      8721,   1485,   3900,  14573,  13029, -24781,   4374,  17286,
     18328,  16356,  -8917, -25056,    564,  23714,  19894,  26622,
     10206,  10248,  10212,   2430,   3108,  20193,   1845,   4142,
     16250,   5439,  16724,    380,  17460,  30488,   5402,   6844,
      5742,   7920,   5202,   6438, -13330,    144,   1944,   2745,
      5964,   8712,   2024,  -9940,   6004,  14535,   5010,  30728,
    -32531,   6624,  11502,   7018,  17160,  10455,  20898,  28000,
     12996,  25668,  11330,  26100,  12096,  10506,    943,  13504,
     -5056,  12688,  28860,  22800,  10008,   2892,  21825, -23812,
     17082,  18492,   2775,  11235,   6201,  12528, -23536,  13572,
     10656,  -7519,   6441,    969,   4025,  18117,  11004,  21840,
    -14927,   6600, -17156,  27467,  22518,   6324,  24075,  32760,
     18183,    649,  18620,  19221,    952,   8550,    170,    384,
     27450,  12870,   8880,  22090,   1518,  10074,   6649, -32454,
     23086,  32399,   5050,    244,  31218,  10220,   2414,   2675,
       276,  26416,   2832,  29896,  11297, -30060,  16614,   1470,
     28614,  13970,  20240, -17831,   1716,  12906, -20536,   4446,
      3120,  24192,    546,   7381,  13020,   8632,  24776, -30344,
     18615,  31152,  11088, -16102, -22880,   5112,   5916,  25545,
     27999, -18301,   1972,   9200,  19872,   7875,   2750,   2847,
     10764,   7866,  23762,  12844, -31792,    192,  32357,   5508,
     15288,   5152,  30340,   1122,  18914,  29056,  12276,  11544,
     30772, -29496,    986,  27264,    109,   1161,   4257, -16240,
     17400,   4187,  15680,   4136,   4256,  16810,  13050,  10530,
     20976,  13662,   4242,  14880,  10545,  10368,   7290,   2982,
      4080,    148,   3182,  11659,  25480,   6848, -22596,  14490,
     20995,   5346,  18096,  10080,    950,   2310,    270,   6534,
      3886,  20070,   3100,  21450,  16650,  10320,   1928,  28158,
    -32209,  16592,  16482,    792,   4321,   6083, -20806,  16896,
      7854,  29376,  10205,   4970,  17303,   2537,  18271,   4070,
     11280,  17168,   2712,   9075,   3300,    330, -22879,  30130,
      6448,   3476,   1320,   5100,  23064,  28728,   6534,  21190,
     28359,  10455,  14931, -32165,   9292,   3588,  10354,  20418,
     16236,  11628,    828,  15265,   2740,   4392,    114,   4830,
      1232,  30294,  20009,  28036,  10388,     30,  18600, -18394,
    -30655,  24786,   5460,  28880,   2832,   4225,  11635,  18865,
     12154,    714,   1520,    716,  13973,  12600,   5928,  13505,
      8056,   1368, -31864,   2646,   1448,   4522, -19556,   8100,
     12445,   5896, -31467,  30942,    222,   5084,  15604,  -8440,
     16472,  17685, -23541,  26656,    882,   5828,  10150,  31136,
     20085,   4526,  12992,  30544, -31246,   4776,   5695,  26827,
      8928,  26136,   9291,  26966,   1480, -23829,   3102,  19558,
      6783,  11534,  18643,   9204,   3905,   1870,   3124,   1320,
       134,  12740,  13797,  21945,   7119,  20770,   3893,   7599,
     12508,    784,   2021,  20504,   8736,   2886,   6118,  24633,
     13144,  15834,  -7936,   3029,   7074,  24048,  -9760, -17048,
      8840,   8690,  16263,   8400,   2880,  30458,   2914,   9152,
      4687,   9071,   7968, -29740,   8284,  22785,  17024,   4324,
       969, -23292,   7425,  22176,  31460,    148,  25596,   7178,
     12980,   7650,  25112,  12512,   1218,   1962,   1066,   1360,
        64,  12636,  25090,  18468,  23377,  20790,  13520, -12956,
    -16477,  15312,   1060, -20506,   2289, -31182,  23166,  21912,
    -14332,   6596,   4968,   2628,   3549,   3472,   3569,   5542,
      3663, -23791,   5424,   2442,  19504,  16212, -24928,   3706,
    -11347,  14940,   1456,  26112,  12870,   1067,   6355, -30864,
     23640,   2028,   2628,  17820,   6300,   1386, -26966,  14094,
      2041,   2080,   3144,  10472,  30504,   3478, -26131,  20640,
     21749,   7104,   1164,    348,  -9606,  12012, -21008,   1870,
    -32168,   6500,   3003,  15022,  19055,   8991,   1680,  12393,
     28024,   5368,   2496,  30744,  12463,  13384,  13320,   1053,
      8775,  10692,   9102,  11016,    130, -17728,   4928,   4876,
       480,   5025, -14604,   5724,   1472,  21420, -24906,   1365,
      2464,   4738,  27000,  10400,    354,  23004,  20532,   6426,
      3658,  27600,  30912,    330,  10750,   5005,   4060,   1107,
     15906,    754,   4032,   3175, -30850,  26598,   2944,   5200,
     13145,   3768, -23626,   1728,   3528,   5448,   8892,   5032,
      8084,  16592,   3567,  30576, -28861, -28684,   4584, -29866,
     21875,   3696,   3390, -25093, -19216, -20363,   4326,  10098,
      2964,   3696, -32216, -32413,   1989, -18724,   8960,  24025,
      2680,   1199,   1116,   5671,   3770,  17190,  14364,   6468,
    -27430,  15616,    774,   6396,  22240,  13845, -28996,  29659,
    -26521,  22344,  28420,  14351, -11124,  20355,  13545,   6486,
     22494,   2796,   7440,   1518,  11661,  17286,   4779,    244,
      2436,  12947,  28644, -11443,    780,  12816,   7820,   7128,
      6156, -23118,   3168,    955,  10608, -27303,  15810,   9380,
     29172,   1056,   4305,   1089,  27594,  20944,   2736,  15048,
     28272, -30991, -31840,   4917,   9600, -13556,   3336, -29962,
     12862,  15972,     60,   8060,  27300,  17444,   2424,   9372,
     19300,  13728,   4257, -28240,    975,   7314,   1064,   4620,
      8470,  32340,   6351, -25279,   1725,   8520,  25758, -27342,
    -29485,   7952,  19392,   9548,   4080,  12654,   6235,  15914,
      3888,   3952,    595,  20592,  30070,  16445,  10608,  27435,
      6549,   5289,  20812,  17570,  20181,   3456,   7181,  15687,
      4998,  22080,  14586,   2222,  32154, -20469,   8475,   8736,
     27040,    572,  26344,  26450,   1610,  12802,   8883,  32185,
      5440,  18696,  11680,   3360,  16376, -19084,  24339, -19776,
    -11964,  16683,  27178,  16750,   3519,  23484,   3321,    258,
      5016,   2436,   5460,  12814, -29275,  17821, -23471,  28224,
     12865,   3718, -25856,   3264,   7680,   9246,  26969,    714,
    -21988,    812,  10200,   9480,   7866,  28290,    903,   4773,
     20832,  28171, -20567, -16268,   9546, -27344,  -9402,   1194,
      6105,   5750,  31871,  29640,    820,    476,   3978,  -3298,
     11008,   3432,   1938,  10560,   1080,   7693, -31026,   3432,
      4256,   3551, -32272,   7750, -26368,  12240,  22172,  26730,
       162,  17272,   2618,   7560,  11165,   1890,    306,  24056,
     29480,  18923,     80,   5434,  23700,  26085,  21712,  28424,
     14520,   8234,   9594,    288,  11096,   6426,  16200,  24926,
       221,  17672,   1141,     45, -10316,  17836,   6880,  19836,
     25179,  28875, -32386,   6254, -27136, -27627,  28424,   8723,
     15576,  13108,   7380,   4800,  10184,  19834,   5334,   9408,
      4202,   1680,  11021,  12036,   1764,  26894, -22664,   8897,
       348,  13377,   4120,   9744,  25573,  19740,  14640,   3515,
     13328, -30448,   1404,  13580,   1088,  13920,   3525,   4440,
    -23149,   2992,    550,  21594,   1768,   4505,   8360,   1386,
     27495,  22763,   4296,  11232,   1254,  11520, -24676,   8510,
      7280,   4560,   4898,  22990,   9082,   1640,   4212, -15786,
      8127,   8964,   7420,  23919,   1872,   7272,   4731, -15106,
    -15408,   3066, -27448,   3154,  10726,  28077,   6660,  14800,
     -7576,  26200, -27481, -24154, -32326, -27898,  24054, -20608,
     19942,  11692, -25971,   1501, -28786, -27655,   7350,  14245,
        39,  15066,  13664,  11356,  31372,   6308,   3666,   3454,
        45,   1377,  25850,   7056,   1365,  13950,   7272,   9744,
    -30592,  24780,  12320, -22612,  12920, -29598,  31080, -27901,
     16480,   7298,  10200, -29758,   3520,  14345,   1836,   2453,
    -31259,  18816,   8944,   7137,  11956,  13197,   8840,  30163,
     11466,   8964,   3485,  11552,   6204,   4674,    240,   2296,
    -27096,  28000,   2151, -17356,  16608,   2170,  21518,  21888,
    -25864,   3618,   9156,    625,  20475,  25544,   6666, -29868,
     17072,   9576, -30114,  -8654,   3042,  24955,  13376,  25830,
    -21611,  22554,   7100,  27935,  13157,   6732,   7097,    108,
     13696,   1943,  20416,  13452,  27216,   8720,    707,   7310,
      9112, -28212,    520,    654,   2820,   1506,   5936, -32242,
      3537,   8281, -32147,    540,  14628,  21896,   4968,  30459,
     30589,  29120,  21632,    923,  28143,  18816,   4050,  30876,
     32357,  26220,   3484,   5934,  13320,   9360,  24888, -22900,
     24645,   3773, -31060,  32472,    882,  12533,   5616,  28576,
      7194,  19968,   3744,   6768,  15624,  32704,  10127, -22805,
     10570,   9396,   2394,   6210,  30870,   1995,  28077,   3542,
     15606,   4288,  17120, -10816,   2736, -31432,    270,    440,
     16320,   1365,   6076,   9360,  27000,   5432,  15435,  -6025,
      6708,   2574,  15120, -24145, -21010,     91,  32706,   4840,
    -25276,   2890,  23718, -13836,    462, -28942,  10816,  16170,
    -27316,  28743,   7056,   6165,   7469,    276,    129,  11760,
    -30466,  14416,   2001,   1110,  11562,   1113,  25920,   2530,
     14304,   4650, -32309,   8109,   8280, -32176,   6460, -20324,
      5994,   5904,   3192,  10682,  20790,   1972,  28272,    880,
      4746, -23936, -25705,    630,  11271,  32490,  26216,  28782,
    -22766,   3610,    144,  24881,  17199,  11184,  27144,   9300,
     15640,  28161,  20900,   6912,   8399,  17544,  27972,  16068,
     23540,   5916,   6188,  22545,  21808,  18848,   8250,  24752,
     32163,   2736,  10062,  15375,  16647,   8640,   4250,  11132,
      9718,   5400,   5452,  13398,  10149, -23528,  25670,    464,
      9245,   3952,    261, -19854,  16416,  18876,  28084,  28625,
     -2551,   1529, -31600,   5368,   9158,  13973,  16836,   1860,
      2622,  23750,  14235, -28170,   3250,  15128,   2400,   9112,
    -18394,  31008,   3330,   6480,   5304,   7616,    957,   3040,
      1848,  16564,   2204,  28764, -25606,   2920, -23767,   2420,
     16640,  25179,   5304, -14692,  11352,  27027,  19680,   3080
     };*/


unsigned long kpow(unsigned long base,unsigned long esponente)
	{
	unsigned long tmp;

	for(tmp=1;esponente>0;esponente--)
		tmp*=base;

	return tmp;
	}

unsigned long kfloor(double __x)
	{
	register double __value;
	__volatile unsigned short int __cw, __cwtmp;

	__asm __volatile ("fnstcw %0" : "=m" (__cw));
	__cwtmp = (__cw & 0xf3ff) | 0x0400;
	__asm __volatile ("fldcw %0" : : "m" (__cwtmp));
	__asm __volatile ("frndint" : "=t" (__value) : "0" (__x));
	__asm __volatile ("fldcw %0" : : "m" (__cw));

	return __value;
	}

unsigned long kceil (double __x)
{
  register double __value;
  __volatile unsigned short int __cw, __cwtmp;

  __asm __volatile ("fnstcw %0" : "=m" (__cw));
  __cwtmp = (__cw & 0xf3ff) | 0x0800; /* rounding up */
  __asm __volatile ("fldcw %0" : : "m" (__cwtmp));
  __asm __volatile ("frndint" : "=t" (__value) : "0" (__x));
  __asm __volatile ("fldcw %0" : : "m" (__cw));

  return __value;
}

int krandseed(int seed)
	{
	krand_seed=seed;;
	return krand_seed;
	}

int	krand()
	{
	int  i, j;

	i=krand_table[krand_seed%RAND_TABLE_SIZE];
	j=krand_table[i%RAND_TABLE_SIZE];

	krand_seed=i+j+(int)(time_tick());
	i=(krand_seed * 2)/-3;

	//Perche'?????4292000000????
	i=ABS(i)-(unsigned int)(4292000000);

	return i;
	}

